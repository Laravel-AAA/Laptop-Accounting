import{r as n,q as m,j as t}from"./app-6796488e.js";import{S as x}from"./SecondaryButton-7f3014e4.js";import{T as b}from"./TemplateModal-58a50956.js";import{C as f}from"./Checkbox-0dbddf9e.js";import{I as g}from"./Input-cda83850.js";import v from"./TotalInfo-aaf83fd3.js";import{N as j}from"./Num-690cb30e.js";import{P as R}from"./PrimaryMaterialBtn-e07d1dfb.js";import{S as y}from"./SecondaryMaterialBtn-b3670ba1.js";import"./transition-71e9253c.js";import"./index-e70dddb0.js";import"./index-6b815d72.js";import"./ErrorMessage-0999ea98.js";function k({form:e}){const[s,r]=n.useState(!1),[l,c]=n.useState(0),u=m().props.auth.business.taxPercent;function d(){return e.data.bill_details.reduce((o,i)=>(i.product.price??0)*i.quantity+o,0)}function a(){return d()*(1+u)}const p=N();return n.useEffect(()=>{e.data.cashReceived!==null&&typeof e.data.id=="string"?c((e.data.cashReceived??0)-a()):e.setData("cashReceived",Number(a().toFixed(2)))},[]),t.jsxs(t.Fragment,{children:[t.jsx(v,{bill:e.data}),t.jsxs("div",{className:"mt-3 w-full",children:[t.jsx(g,{ref:p,label:"Cash Received",name:"cashReceived",type:"number",value:e.data.cashReceived===null?"":Number(e.data.cashReceived.toFixed(2)),className:"mt-1 block w-full text-xl",inputMode:"numeric",autoFocus:!0,onClick:o=>o.currentTarget.select(),disabled:e.processing||s,onChange:o=>{const i=Number(o.target.value);e.setData("cashReceived",i),c(Number(Number((i??0)-a()).toFixed(2)))},required:!1,errorMsg:e.errors.cashReceived,hideError:e.isDirty("cashReceived"),hint:t.jsxs("span",{style:{visibility:s?"hidden":"visible"},className:"ml-1 text-lg text-gray-700",children:["Remaining:Â ",t.jsx(j,{className:"text-gray-900 font-semibold",amount:l})]})}),t.jsx("div",{className:"mt-1 flex items-center",children:t.jsx(f,{label:t.jsx("span",{className:"text-lg text-gray-600",children:"Digital payment"}),name:"isDigitalPayment",className:"h-5 w-5",checked:s,disabled:e.processing,onChange:o=>{s&&setTimeout(()=>{var i,h;(i=p.current)==null||i.focus(),(h=p.current)==null||h.select()},100),r(i=>(s?(e.data.id===void 0&&e.setData("cashReceived",a()),c(0)):(e.data.id===void 0&&e.setData("cashReceived",null),c((e.data.cashReceived??0)-a())),!i))},errorMsg:""})})]})]})}function N(){const e=n.useRef(null);return n.useEffect(()=>{var s;(s=e.current)==null||s.select()},[e.current]),e}function S({form:e,isShow:s,requestClose:r}){const l=n.useRef(null);function c(d){if(JSON.parse(localStorage.getItem("printOnSubmit")??"true"))if(l.current)l.current.href=route("bill.show",{bill:d??"errorID",print:"true"}),l.current.click();else throw new Error("Unexpected linkRef.current value. Got="+l.current)}function u(d){d.preventDefault(),e.post(route("bill.store"),{preserveState:!1,preserveScroll:!1,onSuccess:a=>{r(),e.clearErrors(),e.reset(),new Audio("/assets/Audio/checkout-21.mp3").play(),c(a.props.createdUpdatedBillId)},onError:a=>{console.error(a),a!=null&&a.serverError&&alert(a.serverError)}})}return t.jsxs(t.Fragment,{children:[t.jsx("a",{hidden:!0,target:"_blank",ref:l,href:""}),t.jsx(b,{title:"Checkout",open:s,closeModal:()=>r(),children:t.jsxs("form",{className:"mt-3",onSubmit:u,children:[t.jsx(k,{form:e}),t.jsxs("div",{className:"mt-4 flex flex-col gap-4 sm:flex-row-reverse",children:[t.jsx(R,{type:"submit",disabled:e.processing,children:e.data.id===void 0?"Proceed":"Update"}),t.jsx(y,{type:"button",onClick:()=>{e.cancel(),r(),e.clearErrors()},children:"Cancel"})]})]})},"checkoutTemplateModal")]})}function q({form:e}){const[s,r]=n.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"pointer-events-none absolute bottom-[50px] h-5 w-full bg-gradient-to-t from-white to-transparent opacity-90"}),t.jsx("div",{className:"absolute bottom-0 w-full",children:t.jsx(x,{style:{fontSize:"1.2rem",fontWeight:800},className:"bottom-0  h-[50px] w-full min-w-full rounded-none",disabled:e.processing||e.data.bill_details.length==0,title:e.processing||e.data.bill_details.length==0?"You can't Checkout with an empty cart!":"",onClick:()=>r(!0),children:e.data.id===void 0?"Submit":"Update"})}),t.jsx(S,{isShow:s,requestClose:()=>r(!1),form:e},"CheckoutRightSideCheckoutBtnCheckout")]})}export{q as default};
