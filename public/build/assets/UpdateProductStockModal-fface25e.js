import{r as p,j as t,q as k}from"./app-1ab1ca84.js";import{I as x,H as b}from"./Input-8c223dec.js";import{D as q,S as y}from"./SecondaryMaterialBtn-41567cb8.js";import{S as U}from"./SecondaryButton-e934d2a5.js";import w from"./DefaultProductImg-1db9b475.js";import{u as h}from"./useTranslation-2fada337.js";import{C as _}from"./Checkbox-ffd11b6b.js";import{N as j}from"./Num-9b021e8b.js";import{r as D}from"./index-dae4422a.js";import{E as L}from"./ErrorMessage-e593865f.js";import{D as B}from"./ProductOptions-8f8ca501.js";import{P}from"./PrimaryMaterialBtn-64232e11.js";import{u as S}from"./useBetterForm-40e24ff1.js";import{T as E}from"./TemplateModal-c523cd55.js";import{F as N}from"./FromDate-7d608d36.js";import{K as m}from"./KeyValue-acf150f5.js";import{p as W,d as V}from"./index-e821efab.js";function H({formProps:e,modalAction:a}){const s=a.state,n=e.data.img,[r,i]=p.useState(()=>"default");return s==="create"?t.jsx(f,{img:n,state:s,editImageState:r,form:e}):s==="show"?n===null?t.jsx(w,{}):t.jsx(C,{img:n,productName:e.data.name}):n===null?t.jsx(f,{img:n,state:s,editImageState:r,form:e}):r==="default"?t.jsxs(t.Fragment,{children:[t.jsx(C,{img:n,productName:e.data.name}),t.jsxs("div",{className:"mb-4 mt-1 flex justify-center gap-8",children:[t.jsx(U,{disabled:e.processing,onClick:()=>{i("change")},children:"Change Image"}),t.jsx(q,{disabled:e.processing,onClick:()=>{i("removed"),e.setData("img",null)},children:"Remove Image"})]})]}):t.jsx(f,{img:n,state:s,editImageState:r,form:e})}function C({img:e,productName:a}){return t.jsx("div",{className:"mt-1  rounded-md border border-gray-300",children:t.jsx("img",{className:"mx-auto h-40",src:e!=null&&e.startsWith("http")?e:"products-images/"+e,alt:"Image "+(e??"")+" of product "+a})})}function f({img:e,state:a,editImageState:s,form:n}){const{t:r}=h();return t.jsxs(t.Fragment,{children:[t.jsx(x,{label:(e===null&&a==="edit"||s==="removed"||a==="create"?r("Choose"):s==="change"?r("Change"):"")+" "+r("Image"),type:"file",className:"mt-1 block w-full",accept:"image/*",hidden:!!e,disabled:a==="show"||n.processing,required:!1,onChange:i=>{var l;n.setData("imageFile",((l=i.target.files)==null?void 0:l[0])??null)},errorMsg:n.errors.img||n.errors.imageFile,hideError:n.isDirty("img")||n.isDirty("imageFile"),hint:r("We recommend an image with white background")}),","]})}function K({color:e="teal",variant:a="outlined",size:s="lg",className:n="",errorMsg:r,errorMsgProps:i,hideError:l,error:o,hint:d,hintProps:c,label:u,disabled:v,required:F,autoComplete:J="off",id:I=u.toLowerCase().replaceAll(/[^\w]/g,"-"),name:M=u.toLowerCase().replaceAll(/[^\w]/g,"-"),ref:Q,...T}){o===void 0&&(l===!0?o=!1:r?o=!0:o=!1);const{t:g}=h();return t.jsxs(t.Fragment,{children:[t.jsx(D.Textarea,{onPointerEnterCapture:void 0,onPointerLeaveCapture:void 0,id:I,name:M,label:g(u),"aria-label":g(u),className:n+" focus:ring-0",variant:a,color:e,size:s,error:o,disabled:v,required:v===!0?!1:F,...T}),t.jsx(L,{message:typeof r=="string"?g(r):r,...i}),typeof d=="string"?t.jsx(b,{message:g(d),...c}):t.jsx(b,{children:d})]})}function O({formProps:e,modalAction:a}){const[s,n]=p.useState(!1),[r,i]=p.useState(e.data.price),l=k().props.auth.business.taxPercent;function o(c){return c==null?c:Number(Number(c).toFixed(8))}const{t:d}=h();return t.jsxs("div",{className:"",children:[t.jsx("div",{className:"w-full",children:t.jsx(x,{id:"name",label:"Product Name",name:"name",type:"text",value:e.data.name??void 0,className:"mt-1 block w-full",autoComplete:"off",autoFocus:!0,disabled:a.state==="show"||e.processing,onChange:c=>e.setData("name",c.target.value),required:!0,errorMsg:e.errors.name,hideError:e.isDirty("name")})}),t.jsxs("div",{className:"mt-4",children:[t.jsx(x,{id:"price",label:"Price",type:"number",inputMode:"decimal",autoComplete:"off",name:"price",value:r??void 0,className:"mt-1 block w-full",disabled:a.state==="show"||e.processing,onChange:c=>{const u=o(c.target.value);i(u),e.setData("price",o(s?(u??0)/(1+l):u))},errorMsg:e.errors.price,hideError:e.isDirty("price"),required:!1,hint:a.state==="edit"&&t.jsx("span",{children:d("If you change the price of this product, it may affect the bills that have already been issued with the old price. This could result in incorrect calculations, such as the total price of a bill. Please make sure you have no bills that have this product.")})}),t.jsx("div",{title:l===0?"Tax is 0%":"",children:t.jsx(_,{label:t.jsxs("span",{children:[d("Tax is included.")," (",t.jsx(j,{showCurrency:!0,amount:e.data.price??0})," ",d("without tax"),")"]}),checked:s,errorMsg:void 0,disabled:e.processing||l===0,onChange:c=>{n(u=>(e.setData("price",o(r!=null&&!u?r/(1+l):r)),!u))}})})]}),t.jsx("div",{className:"mt-3",children:t.jsx(x,{id:"stock",label:"Stock",type:"number",name:"stock",value:e.data.stock??void 0,className:"mt-1 block w-full",disabled:a.state==="show"||e.processing,onChange:c=>e.setData("stock",Number(c.target.value)),errorMsg:e.errors.stock,hideError:e.isDirty("stock"),required:!1})}),t.jsx("div",{className:"mt-4",children:t.jsx(x,{label:"Barcode",type:"number",name:"barcode",value:e.data.barcode??void 0,className:"remove-arrow mt-1 block w-full",disabled:a.state==="show"||e.processing,onChange:c=>e.setData("barcode",c.target.value),errorMsg:e.errors.barcode,hideError:e.isDirty("barcode"),required:!1})}),t.jsx("div",{className:"mt-4",children:t.jsx(H,{formProps:e,modalAction:a})}),t.jsx("div",{className:"mt-4",children:t.jsx(K,{label:"Description",value:e.data.description??void 0,onChange:c=>e.setData("description",c.target.value),disabled:a.state==="show"||e.processing,required:!1,errorMsg:e.errors.description,hideError:e.isDirty("description")})})]})}function R({modalAction:e,setModalAction:a,form:s}){const[n,r]=p.useState(!1),{t:i}=h();return t.jsxs("div",{className:"mt-4 flex flex-col gap-4 sm:flex-row-reverse",children:[t.jsxs(P,{type:"submit",disabled:s.processing,children:[" ",i(e.state==="create"?"Create":"Save")]}),t.jsx(y,{type:"button",onClick:()=>{s.cancel(),a(l=>({...l,open:!1})),s.reset(),s.clearErrors()},children:i("Cancel")}),t.jsx(B,{isOpen:n,requestClose:l=>{r(!1),(l==null?void 0:l.toLowerCase().trim())==="delete"&&a(o=>({...o,open:!1}))},product:s.data},"createEditProductDeleteConfirmFormActions")]})}function $({modalAction:e,setModalAction:a}){const s=S(e.state==="create"?{name:"",barcode:null,description:null,imageFile:null,img:null,price:null,stock:null}:{...e.data,_method:"patch"},e.data?e.data.id.toString()+e.data.img:e.state);function n(r){r.preventDefault(),s.post(route(`product.${e.state==="edit"?"update":"store"}`,e.state==="edit"?e.data.id:void 0),{preserveScroll:!0,onSuccess:()=>{s.clearErrors(),s.reset(),a(()=>({state:"create",data:null,open:!1}))}})}return t.jsxs("form",{className:"mt-3",onSubmit:n,children:[t.jsx(O,{formProps:s,modalAction:e}),t.jsx(R,{modalAction:e,setModalAction:a,form:s})]})}function z({product:e}){var i,l;const a=k().props.auth.business.taxPercent,[s,n]=p.useState(!1),{t:r}=h();return t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"rounded-md border border-blue-gray-100",children:e.img?t.jsx("img",{className:"mx-auto h-40",src:(i=e.img)!=null&&i.startsWith("http")?e.img:"products-images/"+e.img,alt:r("Image of product")+" "+e.name}):t.jsx(w,{className:"!my-1"})}),t.jsx(m,{k:"Name",v:e.name}),t.jsx(m,{k:"Price (Tax included)",v:t.jsx(j,{amount:e.price===null?null:e.price*(1+a),defaultNoAmount:!0,showCurrency:!0})}),t.jsx(m,{k:"Price (Tax not included)",v:t.jsx(j,{amount:e.price,defaultNoAmount:!0,showCurrency:!0})}),t.jsx(m,{k:"Stock",v:t.jsx(j,{amount:e.stock,defaultNoAmount:!0})}),t.jsx(m,{k:"Barcode",v:e.barcode}),t.jsx(m,{k:"Description",v:e.description}),t.jsxs("div",{className:"space-y-3 border-t",hidden:!s,children:[t.jsx(m,{className:"mt-3",k:"Created by",v:((l=e.created_by)==null?void 0:l.name)??r("N/A")}),t.jsx(m,{title:new Date(e.created_at).toDateString(),className:"mt-3",k:"Created",v:t.jsx(N,{date:e.created_at})}),t.jsx(m,{title:new Date(e.updated_at).toDateString(),className:"mt-3",k:"Updated",v:t.jsx(N,{date:e.updated_at})})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(D.IconButton,{title:r("More info"),className:"rounded-full",onClick:()=>n(o=>!o),placeholder:void 0,onPointerEnterCapture:void 0,onPointerLeaveCapture:void 0,children:s?t.jsx(W,{}):t.jsx(V,{})})})]})}function pe({modalAction:e,setModalAction:a}){return t.jsx(E,{title:G(e.state),open:e.open,closeModal:()=>a(s=>({...s,open:!1})),children:e.state==="show"?t.jsx(z,{product:e.data}):t.jsx($,{modalAction:e,setModalAction:a})})}function G(e){return e==="create"?"Add New Product":e==="edit"?"Edit Product":"View Product"}function xe({modalAction:e,close:a}){const s=e.product,[n,r]=p.useState(0),i=S({stock:(s==null?void 0:s.stock)??0},s==null?void 0:s.id);p.useEffect(()=>r(0),[s]);function l(d){d.preventDefault(),i.patch(route("product.update",s==null?void 0:s.id),{preserveScroll:!0,onSuccess:()=>{i.clearErrors(),i.reset(),a()}})}const{t:o}=h();return t.jsx(E,{title:"Update Stock",open:e.open,closeModal:()=>{a(),i.reset(),i.clearErrors()},children:t.jsxs("form",{className:"mt-3",onSubmit:l,children:[t.jsx(x,{id:"stock",label:"Add to Stock",type:"number",name:"stock",autoFocus:!0,value:n,className:"mt-1 block w-full",disabled:i.processing,onChange:d=>{i.setData("stock",((s==null?void 0:s.stock)??0)+Number(d.target.value)),r(Number(d.target.value))},errorMsg:i.errors.stock,hideError:i.isDirty("stock"),onFocus:d=>d.target.select(),required:!0,hint:t.jsxs("span",{children:[o("Current stock")," ",t.jsx("span",{className:"font-semibold text-gray-600",children:(s==null?void 0:s.stock)??o("N/A")}),". ",o("Will update to")," ",t.jsx("span",{className:"font-semibold text-gray-600",children:((s==null?void 0:s.stock)??0)+n})]})}),t.jsxs("div",{className:"mt-4 flex flex-col gap-4 sm:flex-row-reverse",children:[t.jsx(P,{type:"submit",disabled:i.processing,children:"Update"}),t.jsx(y,{type:"button",onClick:()=>{i.cancel(),a(),i.reset(),i.clearErrors()},children:"Cancel"})]})]})})}export{pe as C,xe as U};
